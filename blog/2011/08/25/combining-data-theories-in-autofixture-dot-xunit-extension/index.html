<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="width=device-width" name="viewport" /><title>Combining Data Theories in AutoFixture.Xunit extension</title><link href="/feed" rel="alternate" type="application/rss+xml" /><link href="/stylesheets/blog.css?1390813394" media="screen" rel="stylesheet" type="text/css" /></head><body><div id="title"><div><a href="/blog">moodmosaic</a><span>&nbsp;-&nbsp;</span><a href="/">A modern full-stack programmer's journey and ideas.</a></div><div class="line"></div></div><div id="full"><h2>Combining Data Theories in AutoFixture.Xunit extension</h2><div class="undertitle"><a class="tag" href="/blog#xunit.net">xunit.net</a><a class="tag" href="/blog#autofixture">autofixture</a></div><div class="content"><p><a href="http://xunit.codeplex.com/" target="_blank" title="xUnit.net is a unit testing tool for the .NET Framework. Written by the original inventor of NUnit.">xUnit.net</a> supports parameterized tests via data theories which are types deriving from the Xunit.Extensions.DataAttribute type.&#0160;Some popular attributes include:</p>

<p>InlineDataAttribute,&#0160;PropertyDataAttribute and ClassDataAttribute.</p>

<p>AutoFixture.Xunit extension includes a very useful type, for providing auto-data theories, called&#0160;<a href="http://blog.ploeh.dk/2010/10/08/AutoDataTheoriesWithAutoFixture.aspx" target="_blank" title="AutoData Theories with AutoFixture">AutoMoqDataAttribute</a>.&#0160;</p>

<p>Imagine a Scenario where we have a unit test method with 3 parameters.&#0160;We want the first parameters to be supplied by InlineData and the rest by AutoFixture using AutoMoqData.</p>

<pre><code class="c#">[Theory]
[InlineAutoData(&quot;foo&quot;)]
[InlineAutoData(&quot;foo&quot;, &quot;bar&quot;)]
public void Test(string s1, string s2, MyClass myClass)
{
}
</code></pre>

<p>This is now possible using the <strong>InlineAutoDataAttribute</strong> type which is now on the trunk and will be available on next public release (after version 2.1).&#0160;It provides a data source for a data theory, with the data coming from inline values combined with auto-generated data specimens generated by AutoFixture.</p>

<p>InlineAutoDataAttribute derives from <strong>CompositeDataAttribute</strong>,&#0160;an implementation of DataAttribute that composes other DataAttribute instances.</p>

<p>Here is how it works:</p>

<ul>
<li>Delegate the GetData method call to the&#0160;<em>first</em>&#0160;attribute.</li>
<li>Loop through the results from the first attribute and check if the length of each object array matches the number of arguments required by the method.     
<ul>
<li>If so, yield the object array.</li>
<li>If not, invoke GetData on the&#0160;<em>next</em>&#0160;attribute.     
<ul>
<li>Throw away the first objects from the result in order to continue from where it ran out of objects from the first result set and concatenate the rest to the previous array.</li>
</ul>

<p></li>
</ul>
</li>
</ul>
<ul>
<li>Recursively repeat this process until all object arrays have the required length.</li>
</ul>
<blockquote>
<p>While this feature comes with AutoFixture.Xunit extension, the CompositeDataAttribute class depends only on the xunit.extensions assembly.</p>
</blockquote>
<p>You may compile the code from the latest&#0160;<a href="http://autofixture.codeplex.com/SourceControl/list/changesets" target="_blank" title="AutoFixture (changesets)">trunk</a>&#0160;version, alternatively&#0160;the latest build (including strong names) can be downloaded from&#0160;<a href="http://teamcity.codebetter.com/project.html?projectId=project129&amp;tab=projectOverview. " target="_blank">here</a>.</p></p>
</div></div><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'bonusbits';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></body><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24262928-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></html>