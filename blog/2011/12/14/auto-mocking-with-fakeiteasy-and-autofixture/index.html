<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="width=device-width" name="viewport" /><title>Auto-Mocking with FakeItEasy and AutoFixture</title><link href="/images/favicon.ico" rel="icon" type="image/x-icon" /><link href="/feed" rel="alternate" type="application/rss+xml" /><link href="/stylesheets/blog.css?1388832558" media="screen" rel="stylesheet" type="text/css" /></head><body><body><div id="title"><div><h1><a href="/blog" style="color: #222">moodmosaic</a></h1><div><span>by </span><a href="/">Nikos Baxevanis </a><a href="http://creativecommons.org/licenses/by/3.0/" style="color: #877">(license)</a></div></div><div class="line"></div></div><div id="full"><h1><a>Auto-Mocking with FakeItEasy and AutoFixture</a></h1><div class="undertitle"><span class="date">Filed under </span><a class="tag" href="/blog#autofixture">autofixture</a></div><p>AutoFixture can become an auto-mocking container using <a title="The simplest mocking library for .NET 3.5 and Silverlight with deep C# 3.0 integration." href="http://code.google.com/p/moq/" target="_blank">Moq</a>&nbsp;(described <a title="AutoFixture as an auto-mocking container." href="http://blog.ploeh.dk/2010/08/19/AutoFixtureAsAnAutomockingContainer.aspx" target="_blank">here</a>) and <a title="Rhino Mocks is a dynamic mock object framework for the .Net platform. Its purpose is to ease testing by allowing the developer to create mock implementations of custom objects and verify the interactions using unit testing." href="http://hibernatingrhinos.com/open-source/rhino-mocks" target="_blank">Rhino Mocks</a> (described <a title="Rhino Mocks-based auto-mocking with AutoFixture." href="http://blog.ploeh.dk/2010/11/13/RhinoMocksbasedAutomockingWithAutoFixture.aspx" target="_blank">here</a>).</p>

<p>In addition to the above auto-mocking features it is now possible to use <a title="A .Net dynamic fake framework for creating all types of fake objects, mocks, stubs etc. Easier semantics, all fake objects are just that - fakes - the use of the fakes determines whether they're mocks or stubs." href="http://code.google.com/p/fakeiteasy/" target="_blank">FakeItEasy</a>.</p>

<p>To install AutoFixture with Auto Mocking using FakeItEasy, run the following command in the Package Manager Console:</p>

<pre><code class="c#">PM&gt; Install-Package AutoFixture.AutoFakeItEasy
</code></pre>

<p>To use it, add an AutoFakeItEasyCustomization to the Fixture instance:</p>

<pre><code class="c#">var fixture = new Fixture()
    .Customize(new AutoFakeItEasyCustomization());
</code></pre>

<p>Here is a typical usage inside a test method which will automatically create mocked instances using FakeItEasy:</p>

<pre><code class="c#">var fixture = new Fixture()
    .Customize(new AutoFakeItEasyCustomization());
var result = fixture.CreateAnonymous&lt;IInterface&gt;();
</code></pre>

<p>To <em>explicitly </em>use FakeItEasy inside a test you need to <a title="AutoFixture Freeze." href="http://blog.ploeh.dk/2010/03/17/AutoFixtureFreeze.aspx" target="_blank">Freeze</a> it first:</p>

<pre><code class="c#">[Fact]
public void FixtureCanFreezeFake()
{
    // Fixture setup
    var fixture = new Fixture()
        .Customize(new AutoFakeItEasyCustomization());
    var dummy = new object();
    var fake = fixture.Freeze&lt;Fake&lt;IInterface&gt;&gt;();
    fake.CallsTo(x =&gt; x.MakeIt(dummy))
        .Returns(null);
    // Exercise system
    var result = fixture.CreateAnonymous&lt;IInterface&gt;();
    result.MakeIt(dummy);
    // Verify outcome
    A.CallTo(() =&gt; result.MakeIt(dummy)).MustHaveHappened();
    // Teardown
}
</code></pre>

<p>The above example can be made even more elegant by using <a title="AutoData Theories with AutoFixture." href="http://blog.ploeh.dk/2010/10/08/AutoDataTheoriesWithAutoFixture.aspx" target="_blank">AutoData</a> theories:</p>

<pre><code class="c#">
[Theory, AutoFakeData]
public void FixtureCanFreezeFake([Frozen]Fake&lt;IInterface&gt; fake, IInterface sut)
{
    var dummy = new object();
    sut.MakeIt(dummy);
    A.CallTo(() =&gt; sut.MakeIt(dummy)).MustHaveHappened();
}
</code></pre>

<p>Below is the code for the AutoFakeDataAttribute class:</p>

<pre><code class="c#">public class AutoFakeDataAttribute : AutoDataAttribute
{
    public AutoFakeDataAttribute()
        : base(new Fixture().Customize(new AutoFakeItEasyCustomization()))
    {
    }
}
</code></pre>

<p>An automatically published release created from the latest successful build can also be downloaded from&nbsp;<a title="AutoFixture - Downloads" href="http://autofixture.codeplex.com/releases/view/78605" target="_blank">here</a>.</p>
</div><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'bonusbits';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></body><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24262928-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>