<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, user-scalable=no" name="viewport" /><title>Auto-Mocking with FakeItEasy and AutoFixture</title><link href="http://fonts.googleapis.com/css?family=Lora:400,700|Open+Sans" rel="stylesheet" type="text/css" /><link href="/stylesheets/fontello.css?1392372566" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/styles.css?1392372566" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css?1392372566" media="screen" rel="stylesheet" type="text/css" /></head><body><div class="row"><h1>Auto-Mocking with FakeItEasy and AutoFixture</h1><div class="post"><p>AutoFixture can become an auto-mocking container using <a title="The simplest mocking library for .NET 3.5 and Silverlight with deep C# 3.0 integration." href="http://code.google.com/p/moq/" target="_blank">Moq</a>&nbsp;(described <a title="AutoFixture as an auto-mocking container." href="http://blog.ploeh.dk/2010/08/19/AutoFixtureAsAnAutomockingContainer.aspx" target="_blank">here</a>) and <a title="Rhino Mocks is a dynamic mock object framework for the .Net platform. Its purpose is to ease testing by allowing the developer to create mock implementations of custom objects and verify the interactions using unit testing." href="http://hibernatingrhinos.com/open-source/rhino-mocks" target="_blank">Rhino Mocks</a> (described <a title="Rhino Mocks-based auto-mocking with AutoFixture." href="http://blog.ploeh.dk/2010/11/13/RhinoMocksbasedAutomockingWithAutoFixture.aspx" target="_blank">here</a>).</p>

<p>In addition to the above auto-mocking features it is now possible to use <a title="A .Net dynamic fake framework for creating all types of fake objects, mocks, stubs etc. Easier semantics, all fake objects are just that - fakes - the use of the fakes determines whether they're mocks or stubs." href="http://code.google.com/p/fakeiteasy/" target="_blank">FakeItEasy</a>.</p>

<p>To install AutoFixture with Auto Mocking using FakeItEasy, run the following command in the Package Manager Console:</p>
<pre class="highlight csharp"><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install</span><span class="p">-</span><span class="n">Package</span> <span class="n">AutoFixture</span><span class="p">.</span><span class="n">AutoFakeItEasy</span>
</pre>
<p>To use it, add an AutoFakeItEasyCustomization to the Fixture instance:</p>
<pre class="highlight csharp"><span class="n">var</span> <span class="n">fixture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Fixture</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">Customize</span><span class="p">(</span><span class="k">new</span> <span class="nf">AutoFakeItEasyCustomization</span><span class="p">());</span>
</pre>
<p>Here is a typical usage inside a test method which will automatically create mocked instances using FakeItEasy:</p>
<pre class="highlight csharp"><span class="n">var</span> <span class="n">fixture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Fixture</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">Customize</span><span class="p">(</span><span class="k">new</span> <span class="nf">AutoFakeItEasyCustomization</span><span class="p">());</span>
<span class="n">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">fixture</span><span class="p">.</span><span class="n">CreateAnonymous</span><span class="p">&lt;</span><span class="n">IInterface</span><span class="p">&gt;();</span>
</pre>
<p>To <em>explicitly </em>use FakeItEasy inside a test you need to <a title="AutoFixture Freeze." href="http://blog.ploeh.dk/2010/03/17/AutoFixtureFreeze.aspx" target="_blank">Freeze</a> it first:</p>
<pre class="highlight csharp"><span class="na">[Fact]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">FixtureCanFreezeFake</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Fixture setup
</span>    <span class="n">var</span> <span class="n">fixture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Fixture</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">Customize</span><span class="p">(</span><span class="k">new</span> <span class="nf">AutoFakeItEasyCustomization</span><span class="p">());</span>
    <span class="n">var</span> <span class="n">dummy</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">();</span>
    <span class="n">var</span> <span class="n">fake</span> <span class="p">=</span> <span class="n">fixture</span><span class="p">.</span><span class="n">Freeze</span><span class="p">&lt;</span><span class="n">Fake</span><span class="p">&lt;</span><span class="n">IInterface</span><span class="p">&gt;&gt;();</span>
    <span class="n">fake</span><span class="p">.</span><span class="nf">CallsTo</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="nf">MakeIt</span><span class="p">(</span><span class="n">dummy</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">Returns</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
    <span class="c1">// Exercise system
</span>    <span class="n">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">fixture</span><span class="p">.</span><span class="n">CreateAnonymous</span><span class="p">&lt;</span><span class="n">IInterface</span><span class="p">&gt;();</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">MakeIt</span><span class="p">(</span><span class="n">dummy</span><span class="p">);</span>
    <span class="c1">// Verify outcome
</span>    <span class="n">A</span><span class="p">.</span><span class="nf">CallTo</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">result</span><span class="p">.</span><span class="nf">MakeIt</span><span class="p">(</span><span class="n">dummy</span><span class="p">)).</span><span class="nf">MustHaveHappened</span><span class="p">();</span>
    <span class="c1">// Teardown
</span><span class="p">}</span>
</pre>
<p>The above example can be made even more elegant by using <a title="AutoData Theories with AutoFixture." href="http://blog.ploeh.dk/2010/10/08/AutoDataTheoriesWithAutoFixture.aspx" target="_blank">AutoData</a> theories:</p>
<pre class="highlight csharp">
<span class="na">[Theory, AutoFakeData]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">FixtureCanFreezeFake</span><span class="p">([</span><span class="n">Frozen</span><span class="p">]</span><span class="n">Fake</span><span class="p">&lt;</span><span class="n">IInterface</span><span class="p">&gt;</span> <span class="n">fake</span><span class="p">,</span> <span class="n">IInterface</span> <span class="n">sut</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">var</span> <span class="n">dummy</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">();</span>
    <span class="n">sut</span><span class="p">.</span><span class="nf">MakeIt</span><span class="p">(</span><span class="n">dummy</span><span class="p">);</span>
    <span class="n">A</span><span class="p">.</span><span class="nf">CallTo</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">sut</span><span class="p">.</span><span class="nf">MakeIt</span><span class="p">(</span><span class="n">dummy</span><span class="p">)).</span><span class="nf">MustHaveHappened</span><span class="p">();</span>
<span class="p">}</span>
</pre>
<p>Below is the code for the AutoFakeDataAttribute class:</p>
<pre class="highlight csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">AutoFakeDataAttribute</span> <span class="p">:</span> <span class="n">AutoDataAttribute</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">AutoFakeDataAttribute</span><span class="p">()</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="k">new</span> <span class="nf">Fixture</span><span class="p">().</span><span class="nf">Customize</span><span class="p">(</span><span class="k">new</span> <span class="nf">AutoFakeItEasyCustomization</span><span class="p">()))</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>An automatically published release created from the latest successful build can also be downloaded from&nbsp;<a title="AutoFixture - Downloads" href="http://autofixture.codeplex.com/releases/view/78605" target="_blank">here</a>.</p>
</div><a class="twitter" href="https://twitter.com/intent/tweet?url=http%3A%2F%2Fnikosbaxevanis.com%2Fblog%2F2011%2F12%2F14%2Fauto-mocking-with-fakeiteasy-and-autofixture%2F&text=Auto-Mocking+with+FakeItEasy+and+AutoFixture&via=nikosbaxevanis" target="_blank">Tweet This</a><div class="dater">December 14, 2011</div><div class="categories">Published in<a class="category" href="/category/autofixture/">AutoFixture&nbsp;</a> on December 14, 2011</div></div><div class="homer"><a href="/"><i class="icon-tape" style="font-size:32px;"></i></a></div><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24262928-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>