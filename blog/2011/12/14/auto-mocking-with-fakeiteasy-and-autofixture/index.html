<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="Nikos Baxevanis: Full-stack programmer working on small as well as big projects using test-driven development." name="Description" /><title>Auto-Mocking with FakeItEasy and AutoFixture</title><link href="/stylesheets/styles.css?1402919787" media="screen" rel="stylesheet" type="text/css" /></head><body><div><div><h1>Auto-Mocking with FakeItEasy and AutoFixture</h1><div>December 14, 2011</div></div><div><p>AutoFixture can become an auto-mocking container using <a title="The simplest mocking library for .NET 3.5 and Silverlight with deep C# 3.0 integration." href="http://code.google.com/p/moq/" target="_blank">Moq</a>&nbsp;(described <a title="AutoFixture as an auto-mocking container." href="http://blog.ploeh.dk/2010/08/19/AutoFixtureAsAnAutomockingContainer.aspx" target="_blank">here</a>) and <a title="Rhino Mocks is a dynamic mock object framework for the .Net platform. Its purpose is to ease testing by allowing the developer to create mock implementations of custom objects and verify the interactions using unit testing." href="http://hibernatingrhinos.com/open-source/rhino-mocks" target="_blank">Rhino Mocks</a> (described <a title="Rhino Mocks-based auto-mocking with AutoFixture." href="http://blog.ploeh.dk/2010/11/13/RhinoMocksbasedAutomockingWithAutoFixture.aspx" target="_blank">here</a>).</p>

<p>In addition to the above auto-mocking features it is now possible to use <a title="A .Net dynamic fake framework for creating all types of fake objects, mocks, stubs etc. Easier semantics, all fake objects are just that - fakes - the use of the fakes determines whether they're mocks or stubs." href="http://code.google.com/p/fakeiteasy/" target="_blank">FakeItEasy</a>.</p>

<p>To install AutoFixture with Auto Mocking using FakeItEasy, run the following command in the Package Manager Console:</p>
<pre class="highlight text">PM&gt; Install-Package AutoFixture.AutoFakeItEasy
</pre>
<p>To use it, add an AutoFakeItEasyCustomization to the Fixture instance:</p>
<pre class="highlight text">var fixture = new Fixture()
    .Customize(new AutoFakeItEasyCustomization());
</pre>
<p>Here is a typical usage inside a test method which will automatically create mocked instances using FakeItEasy:</p>
<pre class="highlight text">var fixture = new Fixture()
    .Customize(new AutoFakeItEasyCustomization());
var result = fixture.CreateAnonymous&lt;IInterface&gt;();
</pre>
<p>To <em>explicitly </em>use FakeItEasy inside a test you need to <a title="AutoFixture Freeze." href="http://blog.ploeh.dk/2010/03/17/AutoFixtureFreeze.aspx" target="_blank">Freeze</a> it first:</p>
<pre class="highlight text">[Fact]
public void FixtureCanFreezeFake()
{
    // Fixture setup
    var fixture = new Fixture()
        .Customize(new AutoFakeItEasyCustomization());
    var dummy = new object();
    var fake = fixture.Freeze&lt;Fake&lt;IInterface&gt;&gt;();
    fake.CallsTo(x =&gt; x.MakeIt(dummy))
        .Returns(null);
    // Exercise system
    var result = fixture.CreateAnonymous&lt;IInterface&gt;();
    result.MakeIt(dummy);
    // Verify outcome
    A.CallTo(() =&gt; result.MakeIt(dummy)).MustHaveHappened();
    // Teardown
}
</pre>
<p>The above example can be made even more elegant by using <a title="AutoData Theories with AutoFixture." href="http://blog.ploeh.dk/2010/10/08/AutoDataTheoriesWithAutoFixture.aspx" target="_blank">AutoData</a> theories:</p>
<pre class="highlight text">
[Theory, AutoFakeItEasyData]
public void FixtureCanFreezeFake([Frozen]Fake&lt;IInterface&gt; fake, IInterface sut)
{
    var dummy = new object();
    sut.MakeIt(dummy);
    A.CallTo(() =&gt; sut.MakeIt(dummy)).MustHaveHappened();
}
</pre>
<p><strong>Update (2014/02/28)</strong>: It is also possible to use the <code>[Frozen]</code> attribute on the <code>IInterface</code> directly, as <a href="http://blog.ploeh.dk/">Mark Seemann</a> commented <a href="https://github.com/AutoFixture/AutoFixture/issues/251#issuecomment-36285413">here</a>.</p>

<p>Below is the code for the AutoFakeItEasyDataAttribute class:</p>
<pre class="highlight text">public class AutoFakeItEasyDataAttribute : AutoDataAttribute
{
    public AutoFakeItEasyDataAttribute()
        : base(new Fixture().Customize(new AutoFakeItEasyCustomization()))
    {
    }
}
</pre>
<p>An automatically published release created from the latest successful build can also be downloaded from&nbsp;<a title="AutoFixture - Downloads" href="http://autofixture.codeplex.com/releases/view/78605" target="_blank">here</a>.</p>
</div><div><hr /><small>Published in <a href="/category/autofixture/">AutoFixture</a>, by <a href="/">Nikos Baxevanis</a>.</small></div></div><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24262928-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>