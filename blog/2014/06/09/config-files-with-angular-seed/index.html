<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="Programmer using Test-Driven Development, F#, C#, and Haskell. Contributor to open-source code." name="description" /><meta content="F# C# haskell fsharp csharp tdd autofixture" name="keywords" /><title>Config files with angular-seed</title><link href="http://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet" type="text/css" /><link href="/stylesheets/styles.css?1418616678" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css?1418616678" media="screen" rel="stylesheet" type="text/css" /></head><body><div><div><a href="/">←</a></div><div><h1>Config files with angular-seed</h1><div>June 09, 2014 |  <a href="/category/javascript/">JavaScript</a> |  <a href="/category/angularjs/">AngularJS</a></div></div><div><p><em>This post extends the task automation for angular-seed projects described in the <a href="http://nikosbaxevanis.com/blog/2014/06/03/using-grunt-with-angular-seed/">previous</a> post and demonstrates the usage of environment specific configuration files.</em></p>

<p><strong>Scenario</strong></p>

<p>Assuming a <a href="https://docs.angularjs.org/api/auto/object/$provide#constant">constant service</a> named <code>configuration</code> with a parameter name <code>foo</code> and value:</p>

<ul>
<li><code>bar</code> when the application is running on a development machine</li>
<li><code>qux</code> when the application is prepared for deployment to Azure Web Sites</li>
</ul>

<hr>

<p><strong>Step 1 - Specify the configuration values in config.*.json files</strong></p>
<pre class="highlight text">// config.development.json
{
  &quot;foo&quot;: &quot;bar&quot;
}
</pre><pre class="highlight text">// config.azure.json
{
  &quot;foo&quot;: &quot;qux&quot;
}
</pre>
<p>The config.azure.json and config.development.json are the environment specific configuration files we created in the <a href="http://nikosbaxevanis.com/blog/2014/06/03/using-grunt-with-angular-seed/">previous</a> post.</p>

<p><strong>Step 2 - Define the constant service template</strong></p>

<p>Save the following constant service template as config.js in the root directory.</p>
<pre class="highlight text">'use strict';

angular.module('myApp.config', [])
  .constant('configuration', {
    foo: '@@foo'
  });
</pre>
<p>The <a href="https://www.npmjs.org/package/grunt-replace">grunt-replace</a> task generates a config.js file in the <code>app/js</code> folder according to the above template taking into account the config.development.json or config.azure.json values.</p>

<p>At the end of the post it will be possible to dynamically evaluate the expression <code>@@foo</code> to:</p>

<ul>
<li><code>bar</code> by executing <code>grunt replace:developmet</code>.</li>
<li><code>qux</code> by executing <code>grunt replace:azure</code>.</li>
</ul>

<p>The task <code>replace:azure</code> is also part of the <code>grunt</code> deployment pipeline.</p>

<p><strong>Step 3 - Include config.js to index.html</strong></p>
<pre class="highlight diff"><span class="err">diff --git a/app/index.html b/app/index.html
</span><span class="gh">@@ -46,6 +46,7 @@
</span>   &lt;!-- build:js({.tmp,app}) scripts/scripts.js --&gt;
   &lt;script src=&quot;js/app.js&quot;&gt;&lt;/script&gt;
<span class="gi">+  &lt;script src=&quot;js/config.js&quot;&gt;&lt;/script&gt;
</span>   &lt;script src=&quot;js/services.js&quot;&gt;&lt;/script&gt;
   &lt;script src=&quot;js/controllers.js&quot;&gt;&lt;/script&gt;
   &lt;script src=&quot;js/filters.js&quot;&gt;&lt;/script&gt;
</pre>
<p>This file doesn&#39;t exist on disk yet, it is generated by grunt-replace when one of the following tasks is invoked – <code>grunt</code>, <code>grunt replace:development</code>, <code>grunt replace:azure</code>.</p>

<p><strong>Step 4 - Register the constant service to the $injector</strong></p>
<pre class="highlight diff"><span class="err">diff --git a/app/js/app.js b/app/js/app.js
</span><span class="gh">@@ -4,6 +4,7 @@
</span> // Declare app level module which depends on filters, and services
 angular.module('myApp', [
   'ngRoute',
<span class="gi">+  'myApp.config',
</span>   'myApp.filters',
   'myApp.services',
   'myApp.directives',
</pre>
<p><strong>Step 5 - Inject the constant service and consume it</strong></p>
<pre class="highlight diff"><span class="err">diff --git a/app/js/controllers.js b/app/js/controllers.js
</span><span class="gh">@@ -3,8 +3,8 @@
</span> /* Controllers */
<span class="err">
</span> angular.module('myApp.controllers', [])
<span class="gd">-  .controller('MyCtrl1', ['$scope', function($scope) {
-
</span><span class="gi">+  .controller('MyCtrl1', ['$scope', 'configuration', function($scope, configuration) {
+    $scope.foo = configuration.foo;
</span>   }])
   .controller('MyCtrl2', ['$scope', function($scope) {
</pre>
<p>Here we inject the <code>configuration</code> service to controller and bind the <code>foo</code> value to the <a href="https://docs.angularjs.org/guide/scope">scope</a>.</p>

<p><strong>Step 6 - Visualize the configuration value</strong></p>
<pre class="highlight diff"><span class="err">diff --git a/app/partials/partial1.html b/app/partials/partial1.html
@@ -1 +1,3 @@
</span> &lt;p&gt;This is the partial for view 1.&lt;/p&gt;
<span class="gi">+{{foo}}
</span></pre>
<p>Add the <code>{{foo}}</code> expression to <code>partial1.html</code> view and execute:</p>
<pre class="highlight text">grunt replace:development
</pre>
<p>Output:</p>
<pre class="highlight text">Running &quot;replace:development&quot; (replace) task
Replace config.js → app/js/config.js

Done, without errors.


Execution Time (2014-06-09 07:53:16 UTC)
loading tasks         6ms  ■■■■■■■■■■■■ 27%
replace:development  15ms  ■■■■■■■■■■■■■■■■■■■■■■■■■■■■ 68%
Total 22ms
</pre>
<p>Navigating to /#view1 should now render <code>bar</code>.</p>

<hr>

<p>In order to display <code>qux</code> execute:</p>
<pre class="highlight text">grunt replace:azure
</pre>
<p>Output:</p>
<pre class="highlight text">Running &quot;replace:azure&quot; (replace) task
Replace config.js → app/js/config.js

Done, without errors.


Execution Time (2014-06-09 07:54:01 UTC)
loading tasks   6ms  ■■■■■■■■■■■■■ 27%
replace:azure  15ms  ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ 68%
Total 22ms
</pre>
<p>Navigating to /#view1 should now render <code>qux</code>.</p>
</div><div class="questions">Have a question about this post? Ask away on   <a href="http://twitter.com/nikosbaxevanis" target="_blank">Twitter</a> or in <a href="https://github.com/moodmosaic/feedback" target="_blank">my feedback repo</a>.</div></div><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24262928-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>