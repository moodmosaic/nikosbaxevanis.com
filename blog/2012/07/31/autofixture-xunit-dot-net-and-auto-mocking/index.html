<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="Programmer using Test-Driven Development, C# and F#. Core Contributor to AutoFixture." name="Description" /><title>AutoFixture, xUnit.net, and Auto Mocking</title><link href="/stylesheets/styles.css?1404210034" media="screen" rel="stylesheet" type="text/css" /></head><body><div><div><p><a href="/">Nikos Baxevanis</a></p></div><div><h1>AutoFixture, xUnit.net, and Auto Mocking</h1><div>July 31, 2012 |  <a href="/category/xunit.net/">xUnit.net</a> |  <a href="/category/autofixture/">AutoFixture</a> |  <a href="/category/unit-testing/">Unit Testing</a></div></div><div><p><strong>Update</strong>: In AutoFixture 3 <a href="https://github.com/AutoFixture/AutoFixture/wiki/AutoFixture-3.0-Release-Notes#numbers-are-random">numbers are random</a>.</p>

<blockquote>
<p>The features discussed in this post are available when using <a href="https://github.com/AutoFixture/AutoFixture">AutoFixture</a> <a href="http://blog.ploeh.dk/2010/10/08/AutoDataTheoriesWithAutoFixture.aspx">decleratively</a> with the xUnit.net <a href="http://nuget.org/packages/AutoFixture.Xunit/">extension</a>. In addition, it is required to have at least one of the extensions for Auto Mocking using <a href="http://nuget.org/packages/AutoFixture.AutoMoq">AutoMoq</a>, <a href="http://nuget.org/packages/AutoFixture.AutoRhinoMocks">AutoRhinoMocks</a>, <a href="http://nuget.org/packages/AutoFixture.AutoFakeItEasy">AutoFakeItEasy</a>, or <a href="http://nuget.org/packages/AutoFixture.AutoNSubstitute">AutoNSubstitute</a>.</p>
</blockquote>

<p>To install AutoFixture with xUnit.net data theories, run the following command in the Package Manager Console:</p>
<pre class="highlight text">PM&gt; Install-Package AutoFixture.Xunit
</pre>
<p>In the test method below we would like to use xUnit.net data theories to provide:</p>

<ol>
<li>Auto-generated data specimens for <code>d</code>, <code>s</code>, <code>i</code>, <code>a</code>.</li>
<li>Auto-generated data specimens for <code>_</code>, <code>s</code>, <code>i</code>, <code>a</code>, and inline values for <code>d</code>.</li>
<li>Auto-generated data specimens for <code>_</code>, <code>_</code>, <code>i</code>, <code>a</code>, and inline values for <code>d</code>, <code>s</code>.</li>
</ol>
<pre class="highlight text">public void TestMethod(
    double d, string s, IInterface i, AbstractType a)
{
    Assert.True(
        d != 0    &amp;&amp;
        s != null &amp;&amp;
        i != null &amp;&amp;
        a != null
        );
}
</pre>
<blockquote>
<p>That fact that argument <code>i</code> is an interface and argument <code>a</code> is an abstract class prevents us from using <code>[InlineData]</code>, <code>[AutoData]</code>, or <code>[InlineAutoData]</code> attributes.</p>
</blockquote>

<p>AutoFixture allows us to easily define custom DataAttribute derived types:</p>

<ul>
<li>By deriving from AutoDataAttribute and passing to the base constructor a customization that enables auto mocking with Moq, Rhino Mocks, FakeItEasy, or NSubstitute.</li>
<li>By deriving from CompositeDataAttribute and passing to the base constructor an array of DataAttribute derived type instances, e.g. an instance of <code>InlineDataAttribute</code> and an instance of <code>AutoDataAttribute</code> derived type.</li>
</ul>

<p><strong>Auto Mocking using Moq</strong></p>

<p>To install AutoFixture with Auto Mocking using Moq, run the following command in the Package Manager Console:</p>
<pre class="highlight text">PM&gt; Install-Package AutoFixture.AutoMoq
</pre>
<p>We decorate the test method with AutoMoqData and InlineAutoMoqData attributes:</p>
<pre class="highlight text">[Theory]
[AutoMoqData]
[InlineAutoMoqData(2)]
[InlineAutoMoqData(3, &quot;foo&quot;)]
public void WithMoq(
    double d, string s, IInterface i, AbstractType a)
{
    Write(d, s, i, a);
}
</pre>
<p>Output:</p>
<pre class="highlight python"><span class="n">AutoMoqData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">s05080d05</span><span class="o">-</span><span class="n">b874</span><span class="o">-</span><span class="mi">4182</span><span class="o">-</span><span class="n">bba5</span><span class="o">-</span><span class="mi">18678</span><span class="n">ad9b134</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy</span>

<span class="n">InlineAutoMoqData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">sce87888d</span><span class="o">-</span><span class="mi">8</span><span class="n">cc8</span><span class="o">-</span><span class="mi">4</span><span class="n">f69</span><span class="o">-</span><span class="mi">927</span><span class="n">c</span><span class="o">-</span><span class="n">c4b1347d3147</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy</span>

<span class="n">InlineAutoMoqData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">foo</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy</span>
</pre>
<p>Source code:</p>
<pre class="highlight text">internal class AutoMoqDataAttribute : AutoDataAttribute
{
    internal AutoMoqDataAttribute()
        : base(new Fixture().Customize(new AutoMoqCustomization()))
    {
    }
}

internal class InlineAutoMoqDataAttribute : CompositeDataAttribute
{
    internal InlineAutoMoqDataAttribute(params object[] values)
        : base(new DataAttribute[] { 
            new InlineDataAttribute(values), new AutoMoqDataAttribute() })
    {
    }
}
</pre>
<p>More information on AutoFixture with Auto Mocking using Moq can be found at <a href="http://blog.ploeh.dk/2010/08/19/AutoFixtureAsAnAutomockingContainer.aspx">AutoFixture as an auto-mocking container</a> blog post.</p>

<p><strong>Auto Mocking using Rhino Mocks</strong></p>

<p>To install AutoFixture with Auto Mocking using Rhino Mocks, run the following command in the Package Manager Console:</p>
<pre class="highlight text">PM&gt; Install-Package AutoFixture.AutoRhinoMocks
</pre>
<p>We decorate the test method with AutoRhinoMockData and InlineAutoRhinoMockData attributes:</p>
<pre class="highlight text">[Theory]
[AutoRhinoMockData]
[InlineAutoRhinoMockData(2)]
[InlineAutoRhinoMockData(3, &quot;foo&quot;)]
public void WithRhinoMocks(
    double d, string s, IInterface i, AbstractType a)
{
    Write(d, s, i, a);
}
</pre>
<p>Ouput:</p>
<pre class="highlight python"><span class="n">AutoRhinoMockData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">s01172643</span><span class="o">-</span><span class="mi">5162</span><span class="o">-</span><span class="mi">474</span><span class="n">f</span><span class="o">-</span><span class="n">bcfa</span><span class="o">-</span><span class="mi">319</span><span class="n">ef40a8272</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy201f58a5559841bfb41895881489658c</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy5a86172bbda14cc098b4c675c5b7e555</span>

<span class="n">InlineAutoRhinoMockData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">sd3b9c112</span><span class="o">-</span><span class="mi">5181</span><span class="o">-</span><span class="mi">4</span><span class="n">daa</span><span class="o">-</span><span class="mi">9</span><span class="n">b2f</span><span class="o">-</span><span class="mi">333</span><span class="n">c7498044a</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy201f58a5559841bfb41895881489658c</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy5a86172bbda14cc098b4c675c5b7e555</span>

<span class="n">InlineAutoRhinoMockData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">foo</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy201f58a5559841bfb41895881489658c</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy5a86172bbda14cc098b4c675c5b7e555</span>
</pre>
<p>Source code:</p>
<pre class="highlight text">internal class AutoRhinoMockDataAttribute : AutoDataAttribute
{
    internal AutoRhinoMockDataAttribute()
        : base(new Fixture().Customize(new AutoRhinoMockCustomization()))
    {
    }
}

internal class InlineAutoRhinoMockDataAttribute : CompositeDataAttribute
{
    internal InlineAutoRhinoMockDataAttribute(params object[] values)
        : base(new DataAttribute[] { 
            new InlineDataAttribute(values), new AutoRhinoMockDataAttribute() })
    {
    }
}
</pre>
<p>More information on AutoFixture with Auto Mocking using Rhino Mocks can be found at <a href="http://blog.ploeh.dk/2010/11/13/RhinoMocksbasedAutomockingWithAutoFixture.aspx">Rhino Mocks-based auto-mocking with AutoFixture</a> blog post.</p>

<p><strong>Auto Mocking using FakeItEasy</strong></p>

<p>To install AutoFixture with Auto Mocking using FakeItEasy, run the following command in the Package Manager Console:</p>
<pre class="highlight text">PM&gt; Install-Package AutoFixture.AutoFakeItEasy
</pre>
<p>We decorate the test method with AutoFakeItEasyData or InlineAutoFakeItEasyData attributes:</p>
<pre class="highlight text">[Theory]
[AutoFakeItEasyData]
[InlineAutoFakeItEasyData(2)]
[InlineAutoFakeItEasyData(3, &quot;foo&quot;)]
public void WithFakeItEasy(
    double d, string s, IInterface i, AbstractType a)
{
    Write(d, s, i, a);
}
</pre>
<p>Output:</p>
<pre class="highlight python"><span class="n">AutoFakeItEasyData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">s2b4c118b</span><span class="o">-</span><span class="n">d18b</span><span class="o">-</span><span class="mi">4782</span><span class="o">-</span><span class="mi">992</span><span class="n">a</span><span class="o">-</span><span class="n">d4138c65fd2a</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Faked</span> <span class="n">IInterface</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Faked</span> <span class="n">AbstractType</span>

<span class="n">InlineAutoFakeItEasyData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">se8da7e09</span><span class="o">-</span><span class="n">ea4f</span><span class="o">-</span><span class="mi">4</span><span class="n">d16</span><span class="o">-</span><span class="mi">86</span><span class="n">bd</span><span class="o">-</span><span class="mf">4229802e5</span><span class="n">f5d</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Faked</span> <span class="n">IInterface</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Faked</span> <span class="n">AbstractType</span>

<span class="n">InlineAutoFakeItEasyData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">foo</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Faked</span> <span class="n">IInterface</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Faked</span> <span class="n">AbstractType</span>
</pre>
<p>Source code:</p>
<pre class="highlight text">internal class AutoFakeItEasyDataAttribute : AutoDataAttribute
{
    internal AutoFakeItEasyDataAttribute()
        : base(new Fixture().Customize(new AutoFakeItEasyCustomization()))
    {
    }
}

internal class InlineAutoFakeItEasyDataAttribute : CompositeDataAttribute
{
    internal InlineAutoFakeItEasyDataAttribute(params object[] values)
        : base(new DataAttribute[] { 
            new InlineDataAttribute(values), new AutoFakeItEasyDataAttribute() })
    {
    }
}
</pre>
<p>More information on AutoFixture with Auto Mocking using FakeItEasy can be found at <a href="http://nikosbaxevanis.com/2011/12/14/auto-mocking-with-fakeiteasy-and-autofixture/">Auto-Mocking with FakeItEasy and AutoFixture</a> blog post.</p>

<p><strong>Auto Mocking using NSubstitute</strong></p>

<p>To install AutoFixture with Auto Mocking using NSubstitute, run the following command in the Package Manager Console:</p>
<pre class="highlight text">PM&gt; Install-Package AutoFixture.AutoNSubstitute
</pre>
<p>We decorate the test method with AutoNSubstituteData or InlineAutoNSubstituteData attributes:</p>
<pre class="highlight text">[Theory]
[AutoNSubstituteData]
[InlineAutoNSubstituteData(2)]
[InlineAutoNSubstituteData(3, &quot;foo&quot;)]
public void WithNSubstitute(
    double d, string s, IInterface i, AbstractType a)
{
    Write(d, s, i, a);
}
</pre>
<p>Output:</p>
<pre class="highlight python"><span class="n">AutoNSubstituteData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">sf7ce77e0</span><span class="o">-</span><span class="n">c2b3</span><span class="o">-</span><span class="mi">4749</span><span class="o">-</span><span class="n">b9ec</span><span class="o">-</span><span class="mi">78</span><span class="n">f3aba0254a</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy</span>

<span class="n">InlineAutoNSubstituteData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">sf7ba31be</span><span class="o">-</span><span class="mi">3136</span><span class="o">-</span><span class="mi">4</span><span class="n">b50</span><span class="o">-</span><span class="n">a51f</span><span class="o">-</span><span class="mi">3763</span><span class="n">f1d06004</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy</span>

<span class="n">InlineAutoNSubstituteData</span><span class="p">:</span>
  <span class="n">d</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">foo</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">IInterfaceProxy</span>
  <span class="n">a</span> <span class="o">=</span> <span class="n">Castle</span><span class="o">.</span><span class="n">Proxies</span><span class="o">.</span><span class="n">AbstractTypeProxy</span>
</pre>
<p>Source code:</p>
<pre class="highlight text">internal class AutoNSubstituteDataAttribute : AutoDataAttribute
{
    internal AutoNSubstituteDataAttribute()
        : base(new Fixture().Customize(new AutoNSubstituteCustomization()))
    {
    }
}

internal class InlineAutoNSubstituteDataAttribute : CompositeDataAttribute
{
    internal InlineAutoNSubstituteDataAttribute(params object[] values)
        : base(new DataAttribute[] { 
            new InlineDataAttribute(values), new AutoNSubstituteDataAttribute() })
    {
    }
}
</pre>
<p>More information on AutoFixture with Auto Mocking using NSubstitute can be found at <a href="http://blog.ploeh.dk/2013/01/09/NSubstituteAuto-mockingwithAutoFixture/">NSubstitute Auto-mocking with AutoFixture</a> blog post.</p>
</div><div><br /><hr />Have feedback on this post? Let <a href="http://twitter.com/nikosbaxevanis" target="_blank">@nikosbaxevanis</a> know on Twitter.</div></div><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24262928-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>