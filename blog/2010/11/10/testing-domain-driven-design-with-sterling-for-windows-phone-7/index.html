<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="width=device-width" name="viewport" /><title>Testing Domain-Driven Design with Sterling for Windows Phone 7</title><link href="/images/favicon.ico" rel="icon" type="image/x-icon" /><link href="/feed" rel="alternate" type="application/rss+xml" /><link href="/stylesheets/blog.css?1389206281" media="screen" rel="stylesheet" type="text/css" /></head><body><body><div id="title"><div><h1><a href="/blog" style="color: #222">moodmosaic</a></h1><div><span>by </span><a href="/">Nikos Baxevanis </a><a href="http://creativecommons.org/licenses/by/3.0/" style="color: #877">(license)</a></div></div><div class="line"></div></div><div id="full"><h1><a>Testing Domain-Driven Design with Sterling for Windows Phone 7</a></h1><div class="undertitle"><span class="date">Filed under </span><a class="tag" href="/blog#wp">wp</a></div><p><img src="http://farm9.staticflickr.com/8084/8397459857_48e3dfb8a6_o.png" alt="" /></p>

<p>When building applications targeting the Windows Phone 7 (WP7) you often need to create and maintain any kind of data. And while (for security reasons we all understand)&#0160;you can&#39;t access the local&#0160;file system, you can benefit from the&#0160;<a href="http://msdn.microsoft.com/en-us/library/ff402541(VS.92).aspx" target="_blank" title="Isolated Storage Overview for Windows Phone.">Isolated Storage</a>. It&#39;s API is similar with the one exposed in the Silverlight namespace.&#0160;</p>

<p>A good design of a&#0160;<a href="http://en.wikipedia.org/wiki/Domain_model" target="_blank" title="A domain model, or Domain Object Model (DOM) in problem solving and software engineering can be thought of as a conceptual model of a domain of interest (often referred to as a problem domain) which describes the various entities, their attributes and relationships, plus the constraints that govern the integrity of the model elements comprising that problem domain.">Domain model</a>&#0160;knows nothing about persistence. You can use an in-memory database, a relational database, or ..<strong>&ldquo;<strong>an&#0160;Object-Oriented Database&#0160;for WP7 that works with Isolated Storage classes and&#0160;supports full LINQ to Object queries over keys and indexes for fast retrieval of information from large data sets!</strong>&rdquo;&#0160;</strong>Enter&#0160;<a href="http://sterling.codeplex.com/" target="_blank" title="Sterling is a lightweight object-oriented database implementation for Silverlight and Windows Phone 7 that works with your existing class structures. Sterling supports full LINQ to Object queries over keys and indexes for fast retrieval of information from large data sets.">Sterling</a>.</p>

<p>Here is a sample repository implementation using Sterling to store and retrieve data:</p>

<pre><code class="c#">internal class SterlingRepository&lt;T&gt; where T: class, new()
{
    public void Save(T instance)
    {
        App.Database.Save&lt;T&gt;(instance);
    }

    public T LoadById&lt;TKey&gt;(TKey id) where TKey : class
    {
        var query = App.Database.Query&lt;T, TKey&gt;()
                                .Where((table) =&gt; table.Key == id)
                                .FirstOrDefault();

        return query.LazyValue.Value ?? default(T);
    }

    public ICollection&lt;T&gt; FindAll&lt;TKey&gt;()
    {
        var items = App.Database.Query&lt;T, TKey&gt;()
                                .Select((table) =&gt; table.LazyValue.Value)
                                .ToList&lt;T&gt;();
        return items;
    }
}
</code></pre>

<blockquote>
<p>In the sample application I use the domain&#0160;model based on the cargo example used in&#0160;<a href="http://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/ref=sr_1_1?ie=UTF8&amp;s=books&amp;qid=1238687848&amp;sr=8-1" target="_blank" title="http://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/">Eric Evans&#39; book</a>&#0160;which can be found&#0160;<a href="http://dddsamplenet.codeplex.com/" target="_blank" title="A .NET implementation of Domain Driven Design (DDD) sample application based on Eric Evans&#39; examples included in his great book. Project is intended to be used in training, demonstration and experiments.">here</a>.&#0160;</p>
</blockquote>

<p><strong>CargoRepository</strong></p>

<pre><code class="c#">internal sealed class CargoRepository : 
    SterlingRepository&lt;Cargo&gt;, ICargoRepository
{

    public void Store(Cargo cargo)
    {
        Save(cargo);
    }

    public Cargo Find(TrackingId trackingId)
    {
        return LoadById(trackingId.IdString);
    }

    public ICollection&lt;Cargo&gt; FindAll()
    {
        return FindAll&lt;string&gt;();
    }
}
</code></pre>

<p><strong>CargoFactory</strong></p>

<pre><code class="c#">internal static class CargoFactory
{
    public static Cargo CreateNew(string origin, string destination)
    {
        // Method implementation can be found in the sample application.
    }
}
</code></pre>

<p>Armed with the above classes you can create a Cargo, save it using the CargoRepository and load it. Sterling will save the whole object graph and when you load, it will &#0160;defer the creation of the whole object using the&#0160;<a href="http://msdn.microsoft.com/en-us/library/dd642331.aspx" target="_blank" title="http://msdn.microsoft.com/en-us/library/dd642331.aspx">Lazy&lt;T&gt;</a> class.</p>

<pre><code class="c#">public sealed class CargoPageViewModel : PropertyChangedBase
{
    private readonly ICargoRepository repository;

    public SterlingPageViewModel(ICargoRepository repository)
    {
        this.repository = repository;
    }

    public void StoreAndFind()
    {
        Cargo cargo = CargoFactory.CreateNew(&quot;Glyfada&quot;, &quot;Perachora&quot;);
        this.repository.Store(cargo);

        Cargo saved = this.repository.Find(cargo.TrackingId);

        Debug.Assert(cargo.RouteSpecification.Equals(saved.RouteSpecification));
        Debug.Assert(cargo.Delivery.Equals(saved.Delivery));
        Debug.Assert(cargo.Equals(saved));
    }
}
</code></pre>

<p>Your domain model classes can be&#0160;<a href="http://en.wikipedia.org/wiki/Plain_Old_CLR_Object" target="_blank" title="Plain Old CLR Object or POCO is a play on the term POJO, from the Java EE programming world, and is used by developers targeting the Common Language Runtime of the .NET Framework.">POCOs</a>. That is, you don&#39;t have to inherit from anything in order to persist an instance of a type in the database. It just works!</p>

<p>The documentation can be found <a href="http://sterling.codeplex.com/documentation" target="_blank">here</a>. The sample application can be found <a href="https://github.com/moodmosaic/BonusBits.CodeSamples" target="_blank" title="BonusBits Blog source-code.">here</a>.</p>
</div><a class="twitter" href="https://twitter.com/intent/tweet?url=http%3A%2F%2Fnikosbaxevanis.com%2Fblog%2F2010%2F11%2F10%2Ftesting-domain-driven-design-with-sterling-for-windows-phone-7%2F&amp;text=Testing+Domain-Driven+Design+with+Sterling+for+Windows+Phone+7&amp;via=nikosbaxevanis" target="_blank">Tweet This</a><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'bonusbits';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></body><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24262928-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>