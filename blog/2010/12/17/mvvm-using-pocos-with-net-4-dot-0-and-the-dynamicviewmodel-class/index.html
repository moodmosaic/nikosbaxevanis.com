<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, user-scalable=no" name="viewport" /><title>MVVM using POCOs with .NET 4.0 and the DynamicViewModel Class</title><link href="http://fonts.googleapis.com/css?family=Lora:400,700|Open+Sans" rel="stylesheet" type="text/css" /><link href="/stylesheets/fontello.css?1392664185" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/styles.css?1392664185" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/syntax.css?1392664185" media="screen" rel="stylesheet" type="text/css" /></head><body><div class="row"><h1>MVVM using POCOs with .NET 4.0 and the DynamicViewModel Class</h1><div class="post"><blockquote>
<p>This post aims to provide a way to implement the Model View ViewModel (MVVM) architectural pattern using Plain Old CLR Objects (POCOs) while taking full advantage of .NET 4.0 DynamicObject Class.</p>
</blockquote>

<p>In order to apply the Model View ViewModel (MVVM) architectural pattern we need:</p>

<ol>
<li>An instance of the View, (e.g. a UserControl type).</li>
<li>An instance of the ViewModel, which in most scenarios is a class implementing the INotifyPropertyChanged interface (or inherits from a base class getting the implementation for free).</li>
<li>An instance of the Model inside the ViewModel class, for getting the properties to display (and format them if necessary) and also for invoking commands on the model.</li>
</ol>

<p>While we can not avoid step 1 (we need to have something to display to the user) and step 3 (we need to have something the user can read/edit), for basic scenarios we can try to avoid step 2.&#0160;</p>

<p>Taking advantage of the .NET 4.0 and the <a href="http://msdn.microsoft.com/en-us/library/system.dynamic.dynamicobject.aspx" target="_blank" title="Provides a base class for specifying dynamic behavior at run time. This class must be inherited from; you cannot instantiate it directly.">DynamicObject</a>&#0160;Class, we can create a type deriving from the DynamicObject Class and&#0160;specify dynamic behavior at run time. Furthermore, we can implement the <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged.aspx" target="_blank" title="Notifies clients that a property value has changed.">INotifyPropertyChanged</a>&#0160;Interface on the derived type making it a good candidate for Data Binding.</p>

<p>Let&#39;s name our class, DynamicViewModel(Of TModel) Class. It must be able to:</p>

<ol>
<li>Accept references types (any class - a model is usually a class).</li>
<li>Invoke public instance methods.</li>
<li>Invoke public instance methods with arguments passed as CommandParameters.</li>
<li>Get public instance properties.</li>
<li>Set public instance properties.</li>
<li>Notify callers when property change by raising the PropertyChanged event.</li>
<li>If a property change results in chaning other properties, the caller must receive the notification for the other property changes too.</li>
</ol>

<p>Here is the <a href="http://dynamicviewmodel.codeplex.com/SourceControl/changeset/view/9e2b2d03b705#DynamicViewModel%2fDynamicViewModel.cs" target="_blank" title="The DynamicViewModel(Of TModel) Class adds dynamic ViewModel behavior to any class at runtime.">DynamicViewModel(Of TModel)</a> Class:</p>
<pre class="highlight csharp"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.ComponentModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Dynamic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>

<span class="k">internal</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">DynamicViewModel</span><span class="p">&lt;</span><span class="n">TModel</span><span class="p">&gt;</span>
    <span class="p">:</span> <span class="n">DynamicObject</span><span class="p">,</span> <span class="n">INotifyPropertyChanged</span> <span class="n">where</span> <span class="n">TModel</span> <span class="p">:</span> <span class="k">class</span>
<span class="err">{</span>
    <span class="nc">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">MethodInfo</span><span class="p">&gt;</span> <span class="n">methodInfos</span>
        <span class="p">=</span> <span class="nf">GetPublicInstanceMethods</span><span class="p">();</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">PropertyInfo</span><span class="p">&gt;</span> <span class="n">propInfos</span>
        <span class="p">=</span> <span class="nf">GetPublicInstanceProperties</span><span class="p">();</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">TModel</span> <span class="n">model</span><span class="p">;</span>

    <span class="k">private</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">propertyValues</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">DynamicViewModel</span><span class="p">(</span><span class="n">TModel</span> <span class="n">model</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">model</span> <span class="p">=</span> <span class="n">model</span><span class="p">;</span>
        <span class="nf">NotifyChangedProperties</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="nf">DynamicViewModel</span><span class="p">(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">TModel</span><span class="p">&gt;</span> <span class="n">@delegate</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="n">@delegate</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">())</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">TryInvokeMember</span><span class="p">(</span><span class="n">InvokeMemberBinder</span> <span class="n">binder</span><span class="p">,</span>
        <span class="kt">object</span><span class="p">[]</span> <span class="n">args</span><span class="p">,</span> <span class="k">out</span> <span class="kt">object</span> <span class="n">result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>

        <span class="n">MethodInfo</span> <span class="n">methodInfo</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">methodInfos</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">binder</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
            <span class="k">out</span> <span class="n">methodInfo</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span>

        <span class="n">methodInfo</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
        <span class="nf">NotifyChangedProperties</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">TryGetMember</span><span class="p">(</span><span class="n">GetMemberBinder</span> <span class="n">binder</span><span class="p">,</span>
        <span class="k">out</span> <span class="kt">object</span> <span class="n">result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">var</span> <span class="n">propertyValues</span> <span class="p">=</span> <span class="n">Interlocked</span><span class="p">.</span><span class="nf">CompareExchange</span><span class="p">(</span>
            <span class="k">ref</span> <span class="k">this</span><span class="p">.</span><span class="n">propertyValues</span><span class="p">,</span> <span class="nf">GetPropertyValues</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(!</span><span class="n">propertyValues</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">binder</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
            <span class="k">out</span> <span class="n">result</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">TrySetMember</span><span class="p">(</span><span class="n">SetMemberBinder</span> <span class="n">binder</span><span class="p">,</span> <span class="kt">object</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PropertyInfo</span> <span class="n">propInfo</span> <span class="p">=</span> <span class="n">propInfos</span><span class="p">[</span><span class="n">binder</span><span class="p">.</span><span class="n">Name</span><span class="p">];</span>
        <span class="n">propInfo</span><span class="p">.</span><span class="nf">SetValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>

        <span class="nf">NotifyChangedProperties</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">NotifyChangedProperties</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Interlocked</span><span class="p">.</span><span class="nf">CompareExchange</span><span class="p">(</span>
            <span class="k">ref</span> <span class="k">this</span><span class="p">.</span><span class="n">propertyValues</span><span class="p">,</span> <span class="nf">GetPropertyValues</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>

        <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">previousPropValues</span>
            <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">propertyValues</span><span class="p">;</span>

        <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">currentPropValues</span>
            <span class="p">=</span> <span class="nf">GetPropertyValues</span><span class="p">();</span>

        <span class="k">this</span><span class="p">.</span><span class="n">propertyValues</span>
            <span class="p">=</span> <span class="n">currentPropValues</span><span class="p">;</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">propValue</span>
            <span class="k">in</span> <span class="n">currentPropValues</span><span class="p">.</span><span class="nf">Except</span><span class="p">(</span><span class="n">previousPropValues</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nf">RaisePropertyChanged</span><span class="p">(</span><span class="n">propValue</span><span class="p">.</span><span class="n">Key</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">MethodInfo</span><span class="p">&gt;</span> <span class="nf">GetPublicInstanceMethods</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">var</span> <span class="n">methodInfoDictionary</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">MethodInfo</span><span class="p">&gt;();</span>
        <span class="n">MethodInfo</span><span class="p">[]</span> <span class="n">methodInfos</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">TModel</span><span class="p">).</span><span class="nf">GetMethods</span><span class="p">(</span>
            <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="n">MethodInfo</span> <span class="n">methodInfo</span> <span class="k">in</span> <span class="n">methodInfos</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">methodInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">&quot;get_&quot;</span><span class="p">)</span> <span class="p">||</span>
                <span class="n">methodInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">&quot;set_&quot;</span><span class="p">))</span> <span class="p">{</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
            <span class="n">methodInfoDictionary</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">methodInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">methodInfo</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">methodInfoDictionary</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">PropertyInfo</span><span class="p">&gt;</span>
        <span class="nf">GetPublicInstanceProperties</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">var</span> <span class="n">propInfoDictionary</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">PropertyInfo</span><span class="p">&gt;();</span>
        <span class="n">PropertyInfo</span><span class="p">[]</span> <span class="n">propInfos</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">TModel</span><span class="p">).</span><span class="nf">GetProperties</span><span class="p">(</span>
            <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="n">PropertyInfo</span> <span class="n">propInfo</span> <span class="k">in</span> <span class="n">propInfos</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">propInfoDictionary</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">propInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">propInfo</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">propInfoDictionary</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="nf">GetPropertyValues</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">var</span> <span class="n">bindingPaths</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;();</span>
        <span class="n">PropertyInfo</span><span class="p">[]</span> <span class="n">propInfos</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">TModel</span><span class="p">).</span><span class="nf">GetProperties</span><span class="p">(</span>
            <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="n">PropertyInfo</span> <span class="n">propInfo</span> <span class="k">in</span> <span class="n">propInfos</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">bindingPaths</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span>
                <span class="n">propInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
                <span class="n">propInfo</span><span class="p">.</span><span class="nf">GetValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">model</span><span class="p">,</span> <span class="k">null</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">bindingPaths</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">RaisePropertyChanged</span><span class="p">(</span><span class="kt">string</span> <span class="n">propertyName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="k">new</span> <span class="nf">PropertyChangedEventArgs</span><span class="p">(</span><span class="n">propertyName</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="n">PropertyChangedEventArgs</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PropertyChangedEventHandler</span> <span class="n">temp</span> <span class="p">=</span>
            <span class="n">Interlocked</span><span class="p">.</span><span class="nf">CompareExchange</span><span class="p">(</span><span class="k">ref</span> <span class="n">PropertyChanged</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">temp</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">event</span> <span class="n">PropertyChangedEventHandler</span> <span class="n">PropertyChanged</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>The sample application for this post comes with a simple ContactView which has no specific viewModel but instead uses the DynamicViewModel(Of TModel) class.</p>

<p>The DynamicViewModel(Of TModel) Class is able to update the View which binds to an instance of this class.</p>

<p>Here is what the sample application does:</p>

<ol>
<li>Changing the First Name will result in changing the Full Name and the Reversed Full Name.</li>
<li>The same rules apply when chaning the Last Name.&#0160;</li>
<li>The&#0160;hyper-link is enabled only if the user presses the Clear Names button.&#0160;</li>
<li>The Clear Names button is enabled only when the Full Name text is not empty.</li>
</ol>

<p>Here is the POCO model class that I have used:</p>
<pre class="highlight csharp"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">internal</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">ContactDetails</span>
<span class="p">{</span> 
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">firstName</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">set</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">firstName</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>

            <span class="nf">SetFullName</span><span class="p">();</span>
            <span class="nf">SetReversedFullName</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">lastName</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">set</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">lastName</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>

            <span class="nf">SetFullName</span><span class="p">();</span>
            <span class="nf">SetReversedFullName</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">FullName</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">fullName</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">set</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">fullName</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">ClearFullName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">FirstName</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        <span class="n">LastName</span>  <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// &lt;summary&gt;
</span>    <span class="c1">/// Navigates to this contact's website.
</span>    <span class="c1">/// &lt;/summary&gt;
</span>    <span class="c1">/// &lt;param name=&quot;uriString&quot;&gt;The URI string.&lt;/param&gt;
</span>    <span class="k">public</span> <span class="k">void</span> <span class="nf">NavigateTo</span><span class="p">(</span><span class="kt">string</span> <span class="n">uriString</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">uriString</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">SetFullName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">FullName</span> <span class="p">=</span> <span class="n">FirstName</span> <span class="p">+</span> <span class="s">&quot; &quot;</span> <span class="p">+</span> <span class="n">LastName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// (Less important members not shown)
</span><span class="p">}</span>
</pre>
<p>As you notice, this class <em>does not implement any interface or base class</em>. In fact, this class can be used successfully in ORM scenarios too (when you need to bind on the same classes that are used in your mappings).</p>

<p>Finally, I would like to show how the View&#39;s DataContext is initialized properly to accept the DynamicViewModel(Of TModel) Class wrapper around the model class:</p>
<pre class="highlight csharp"><span class="c1">/// &lt;summary&gt;
/// Interaction logic for ContactView.xaml
/// &lt;/summary&gt;
</span><span class="k">internal</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">ContactView</span> <span class="p">:</span> <span class="n">UserControl</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">RoutedCommand</span> <span class="n">ClearNamesCommand</span>
        <span class="p">=</span> <span class="k">new</span> <span class="nf">RoutedCommand</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">RoutedCommand</span> <span class="n">NavigateUriCommand</span>
        <span class="p">=</span> <span class="k">new</span> <span class="nf">RoutedCommand</span><span class="p">();</span>

    <span class="k">public</span> <span class="nf">ContactView</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">InitializeComponent</span><span class="p">();</span>

        <span class="c1">// Create a new instance. Once created
</span>        <span class="c1">// do not call methods directly on this
</span>        <span class="c1">// object. (Use the dynamic viewModel).
</span>        <span class="n">var</span> <span class="n">instance</span>  <span class="p">=</span> <span class="k">new</span> <span class="nf">ContactDetails</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;Nikos&quot;</span><span class="p">,</span>
            <span class="n">LastName</span>  <span class="p">=</span> <span class="s">&quot;Baxevanis&quot;</span>
        <span class="p">};</span>

        <span class="n">dynamic</span> <span class="n">viewModel</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DynamicViewModel</span><span class="p">&lt;</span><span class="n">ContactDetails</span><span class="p">&gt;(</span><span class="n">instance</span><span class="p">);</span>

        <span class="c1">// Wire the ClearNamesCommand from the view to the viewModel.
</span>        <span class="n">CommandManager</span><span class="p">.</span><span class="nf">RegisterClassCommandBinding</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ContactView</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">CommandBinding</span><span class="p">(</span>
                <span class="n">ClearNamesCommand</span><span class="p">,</span>
                <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">viewModel</span><span class="p">.</span><span class="nf">ClearFullName</span><span class="p">();</span> <span class="p">},</span>
                <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">e</span><span class="p">.</span><span class="n">CanExecute</span> <span class="p">=</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span>
                     <span class="n">viewModel</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span> <span class="p">}));</span>

        <span class="c1">// Wire the NavigateUriCommand from the view to the viewModel.
</span>        <span class="n">CommandManager</span><span class="p">.</span><span class="nf">RegisterClassCommandBinding</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ContactView</span><span class="p">),</span>
            <span class="k">new</span> <span class="nf">CommandBinding</span><span class="p">(</span>
                <span class="n">NavigateUriCommand</span><span class="p">,</span>
                <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">viewModel</span><span class="p">.</span><span class="nf">NavigateTo</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Parameter</span><span class="p">);</span> <span class="p">},</span>
                <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">e</span><span class="p">.</span><span class="n">CanExecute</span> <span class="p">=</span>                
                    <span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">viewModel</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span> <span class="p">}));</span>

        <span class="n">DataContext</span> <span class="p">=</span> <span class="n">viewModel</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Notice that wiring between the <a href="http://msdn.microsoft.com/en-us/library/system.windows.input.icommand.aspx" target="_blank" title="Defines a command.">ICommand</a>&#0160;Interface and the model class is done outside the dynamic ViewModel wrapper using the <a href="http://msdn.microsoft.com/en-us/library/system.windows.input.commandmanager.aspx" target="_blank" title="Provides command related utility methods that register CommandBinding and InputBinding objects for class owners and commands, add and remove command event handlers, and provides services for querying the status of a command.">CommandManager</a>&#0160;Class which acts as a <a href="http://en.wikipedia.org/wiki/Mediator_pattern" target="_blank" title="Provides a unified interface to a set of interfaces in a subsystem.">mediator</a> between the View and the ViewModel. This give us the flexibility to define static reusable commands or specific commands for each view (as I&#39;ve done above).</p>

<p>The sample application can be found <a href="http://dynamicviewmodel.codeplex.com/releases/view/57761" target="_blank" title="moodmosaic / DynamicViewModel">here</a>.</p>
</div><a class="twitter" href="https://twitter.com/intent/tweet?url=http%3A%2F%2Fnikosbaxevanis.com%2Fblog%2F2010%2F12%2F17%2Fmvvm-using-pocos-with-net-4-dot-0-and-the-dynamicviewmodel-class%2F&text=MVVM+using+POCOs+with+.NET+4.0+and+the+DynamicViewModel+Class&via=nikosbaxevanis" target="_blank">Tweet This</a><div class="dater">December 17, 2010</div><div class="categories">Published in<a class="category" href="/category/wpf/">WPF&nbsp;</a> on December 17, 2010</div></div><div class="homer"><a href="/"><i class="icon-tape" style="font-size:32px;"></i></a></div><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-24262928-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>